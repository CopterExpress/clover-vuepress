import{_ as e,e as t}from"./app.4f6a4bec.js";import{_ as n,a,b as i}from"./IR_transmitter.30c64d98.js";const o={},s=t('<h1 id="working-with-ir-sensors-on-raspberry-pi-3" tabindex="-1"><a class="header-anchor" href="#working-with-ir-sensors-on-raspberry-pi-3" aria-hidden="true">#</a> Working with IR sensors on Raspberry Pi 3</h1><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>This article is not relevant for the latest versions of the <em>clover</em> image and works only on the versions <em>clover_v0.16-clover_v0.17</em>.</p></div><p>Infrared sensors are a convenient tool for transmitting any commands to the copter. They are flexible in configuration, and interaction with them is possible in Python.</p><h2 id="connecting-the-ir-receiver" tabindex="-1"><a class="header-anchor" href="#connecting-the-ir-receiver" aria-hidden="true">#</a> Connecting the IR receiver</h2><p>Most IR receivers operate and are connected the same way. Such receivers have 3 pins for connecting: G/GND \u2014 ground V/VCC \u2014 5V power, S/OUT \u2014 signal.</p><img src="'+n+`" height="500px" alt="ir receiver connection to raspberry"><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The signal port doesn&#39;t have to be connected to port GPIO 17; this pin may be changed during the <a href="#in/out">in/out port settings</a>.</p></div><h2 id="configuring-the-ir-receiver-to-work-with-the-lirc-module" tabindex="-1"><a class="header-anchor" href="#configuring-the-ir-receiver-to-work-with-the-lirc-module" aria-hidden="true">#</a> Configuring the IR receiver to work with the LIRC module</h2><p>LIRC (Linux Infrared Remote Control) is a stable and time-proven open source library, which allows sending and receiving commands via an infrared port. LIRC is supported by Raspbian.</p><p>To install LIRC and related modules, connect your Raspberry Pi to the Internet and run the console command:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo apt-get update
sudo apt-get install lirc
sudo apt-get install python-lirc
pip install py-irsend

</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>To correctly edit the system files, superuser privileges are required; when calling a text editor, use <code>sudo</code>.</p></div><p><a name="in/out"></a> After installing the module, edit file <code>/etc/modules</code> and add line:</p><div class="language-text ext-text"><pre class="language-text"><code>lirc_dev
lirc_rpi gpio_in_pin=18 gpio_out_pin=17
</code></pre></div><p>Where:</p><ul><li><code>gpio_in_pin</code> is the input pin from the receiver</li><li><code>gpio_out_pin</code> is the transmitter output pin</li></ul><p>Update the following line in file <code>/boot/config.txt</code>:</p><div class="language-text ext-text"><pre class="language-text"><code>dtoverlay=lirc-rpi,gpio_in_pin=18,gpio_out_pin=17
</code></pre></div><p>Add the following lines to file <code>/etc/lirc/hardware.conf</code>. Is this file does not exist, create it yourself.</p><div class="language-text ext-text"><pre class="language-text"><code>LIRCD_ARGS=&quot;--uinput --listen&quot;
LOAD_MODULES=true
DRIVER=&quot;default&quot;
DEVICE=&quot;/dev/lirc0&quot;
MODULES=&quot;lirc_rpi&quot;
</code></pre></div><p>Update the following lines in file <code>/etc/lirc/lirc_options.conf</code></p><div class="language-text ext-text"><pre class="language-text"><code>driver    = default
device    = /dev/lirc0
</code></pre></div><p>All required settings are made, you now have to restart your Raspberry Pi device to complete the installation. To do so, run:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo reboot
</code></pre></div><p>After rebooting, check its status by calling command:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo /etc/init.d/lircd status
</code></pre></div><p>If everything has been done correctly, the status should be <code>active</code>. To check whether the installed module LIRC is running, disable daemon <code>lircd</code>, and call the appropriate command:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo /etc/init.d/lircd stop
mode2 -d /dev/lirc0
</code></pre></div><p>Now point the IR transmitter on your device and tap a few keys. You should see something like this:</p><div class="language-text ext-text"><pre class="language-text"><code>space 402351
pulse 135
space 7085
pulse 85
space 2903
pulse 560
space 1706
pulse 535
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you are using an IR transmitter (a TV remote, an air conditioner remote, etc. and you are not getting the signal when checking, your remote is evidently using another signal frequency. When using receivers such as TSOP 22XX, the operating frequency of the signal reception will be in the range between 30 and 50 kHz.</p></div><h2 id="write-your-configuration-of-the-ir-transmitter" tabindex="-1"><a class="header-anchor" href="#write-your-configuration-of-the-ir-transmitter" aria-hidden="true">#</a> Write your configuration of the IR transmitter</h2><p><a name="remote_control"></a></p><p>If you want to use your own IR transmitter, you will have to write its specific settings using the supplied module <code>irrecord</code>. For this purpose, disable daemon <code>lircd</code>, and call the appropriate command. During transmitter calibration, stick to all written instructions.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Please note that the last step of the calibration will be specifying the names of the keys that you will want to decode programmatically. To view the list of available names, call command <code>irrecord --list-namespace</code>.</p></div><div class="language-text ext-text"><pre class="language-text"><code>irrecord -d /dev/lirc0 ~/lircd.conf
</code></pre></div><p>If you have managed to successfully write the configuration of your transmitter, file <code>your-name.lircd.conf</code> should appear in folder <code>/home/pi/</code>. Now you need to move the written configuration file to working folder <code>lirc</code>, and restart the daemon:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo cp ~/your-name.lircd.conf /etc/lirc/lircd.conf
sudo /etc/init.d/lircd restart
</code></pre></div><p>To check whether the written configuration is recognized, call the appropriate module. Now when you tap the keys that you have specified in the previously created configuration, the terminal will show debug information about which key has been pressed.</p><div class="language-text ext-text"><pre class="language-text"><code>irw
</code></pre></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>when working with some transmitters, there are situations where the bit descriptions of keys are redundant; in this case, command <code>irw</code> may fail. To correct this error, open file <code>etc/lirc/lircd.conf</code> and check what the description of your keys looks like; if it looks like <code>KEY_1 0x00FF6897 0x7EE0CF2C</code> and in all lines the second digits match, you have to remove it, so that lines with keys assignment looks like <code>KEY_1 0x00FF6897</code> and all digits in them are unique. After completing these steps, close the file and restart the daemon.</p></div><p>If you did everything correctly, upon tapping a key, you will see the output similar to:</p><div class="language-text ext-text"><pre class="language-text"><code>0000000000ff6897 00 KEY_1 pult
0000000000ff6897 01 KEY_1 pult
0000000000ff9867 00 KEY_2 pult
0000000000ff9867 01 KEY_2 pult
</code></pre></div><p>This means that your configuration is correctly detected by the program, and now you can program the desired action for tapping appropriate keys.</p><h2 id="working-with-ir-sensors-in-python" tabindex="-1"><a class="header-anchor" href="#working-with-ir-sensors-in-python" aria-hidden="true">#</a> Working with IR sensors in Python</h2><p>To be able to use signals from the IR receiver in Python programs, you&#39;ll need package <code>python-lirc</code>. <a href="#install">Install it</a>, if necessary.</p><p>For correct obtaining information, create file <code>lircrc</code> in your own script, which will store settings of your keys and the program response upon calling.</p><p>This file is created in the folder from which your script will be called, <code>/home/pi/</code> by default.</p><p>To create the required file, use any text editor:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo nano .lircrc
</code></pre></div><p>The format of this file should be something like this:</p><div class="language-text ext-text"><pre class="language-text"><code>begin
prog = myprogram
button = KEY_1
config = one
end

begin
prog = myprogram
button = KEY_2
config = two
end
</code></pre></div><p>Where:</p><ul><li><code>prog</code> is the name of the program that you will call from your script</li><li><code>key</code> is the name of the key that you entered during transmitter setup</li><li><code>config</code> is the information to be passed to your program upon tapping a specified key</li></ul><p>All settings are now made, and you can proceed directly to programming IR signals.</p><p>For this purpose, create a Python script that will accept the values of the keys pressed and perform required action s accordingly. An example of such a script:</p><div class="language-python ext-py"><pre class="language-python"><code><span class="token keyword">import</span> lirc
<span class="token keyword">import</span> fly_module

<span class="token comment"># ...</span>

sockid <span class="token operator">=</span> lirc<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token string">&#39;myprogram&#39;</span><span class="token punctuation">)</span>

inf <span class="token operator">=</span> lirc<span class="token punctuation">.</span>nextcode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> inf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;You pressed key 1&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> inf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;You pressed key 2&#39;</span><span class="token punctuation">)</span>

lirc<span class="token punctuation">.</span>deinit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="working-with-the-ir-transmitter" tabindex="-1"><a class="header-anchor" href="#working-with-the-ir-transmitter" aria-hidden="true">#</a> Working with the IR transmitter</h2><p>To work with the IR transmitter, connect it to the ports specified <a href="#in/out">during setup</a>.</p><img src="`+a+'" height="500px" alt="IR transmitter connection to raspberry"><img src="'+i+`" height="200px" alt="IR transmitter scheme"><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>if you are using a ready IR transmitter board, connect it to required pins of Raspberry in accordance with pins marking, in the same way as with the receiver.</p></div><p>If everything has been properly connected, you will be able to send signals specified in <a href="#remote_control">transmitter settings</a> using the command:</p><div class="language-text ext-text"><pre class="language-text"><code>irsend SEND_ONCE deviceName keyName
</code></pre></div><p>Where:</p><ul><li>SEND_ONCE is the parameter responsible for sending a single signal, or sending a signal from a depressed and held down key</li><li>deviceName is the name of the transmitter specified during <a href="#remote_control">setup</a></li><li>keyName is the name of one of the keys specified during transmitter configuration</li></ul><p>To work with <code>irsend</code> inside your script, you&#39;ll need module <code>python-irsend</code>; if necessary, <a href="#install">install it</a>.</p><p>To use <code>irsend</code>, import the library and call the appropriate command:</p><div class="language-python ext-py"><pre class="language-python"><code><span class="token keyword">from</span> py_irsend <span class="token keyword">import</span> irsend


irsend<span class="token punctuation">.</span>send_once<span class="token punctuation">(</span><span class="token string">&#39;YourRemote&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;YourKey&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>Where:</p><ul><li>YourRemote is the name of your transmitter specified during setup</li><li>YourKey is the name of one of the buttons specified during setup</li></ul>`,71);function r(c,p){return s}var u=e(o,[["render",r],["__file","ir_sensors.html.vue"]]);export{u as default};
