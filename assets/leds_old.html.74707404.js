import{_ as i,r as o,o as r,c,a as n,b as e,w as l,F as u,d as s,e as a}from"./app.4f6a4bec.js";import{_ as d}from"./led_connection.ab13db50.js";const h={},k=n("h1",{id:"working-with-a-led-strip-on-raspberry-3",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#working-with-a-led-strip-on-raspberry-3","aria-hidden":"true"},"#"),s(" Working with a LED strip on Raspberry 3")],-1),m=n("h2",{id:"connecting-and-determining-the-type-of-the-strip",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#connecting-and-determining-the-type-of-the-strip","aria-hidden":"true"},"#"),s(" Connecting and determining the type of the strip")],-1),_={class:"custom-container tip"},f=n("p",{class:"custom-container-title"},"TIP",-1),b=s("The following is applicable to image versions 0.14 and up. For versions 0.13 and older see "),y={href:"https://github.com/CopterExpress/clover/blob/v0.16/docs/en/leds.md",target:"_blank",rel:"noopener noreferrer"},g=s("an older revision of this article"),w=n("p",null,[s("Connect the +5v and GND leads of your LED to a power source and the DIN (data in) lead to GPIO18 or "),n("strong",null,"GPIO21"),s(" (by default).")],-1),v=n("img",{src:d,height:"400px",alt:"leds"},null,-1),D=n("div",{class:"custom-container warning"},[n("p",{class:"custom-container-title"},"WARNING"),n("p",null,"LED strip can consume a lot of power! Powering it from a Raspberry Pi may overload the computer's power circuitry. Consider using a separate BEC as a power source.")],-1),E={class:"custom-container tip"},x=n("p",{class:"custom-container-title"},"TIP",-1),P=s("If you are using "),L=s("GPIO"),I=s(" along with the LED strip, connect the strip to GPIO21. Otherwise you may experience unintended strip behavior."),C=a(`<h2 id="ros-and-python-compatibility" tabindex="-1"><a class="header-anchor" href="#ros-and-python-compatibility" aria-hidden="true">#</a> ROS and Python compatibility</h2><p>LED strip library requires you to run your Python scripts with <code>sudo</code>. In order to make it work with ROS nodes you have to add the following lines to your <code>/etc/sudoers</code> file on the Raspberry Pi:</p><div class="language-text ext-text"><pre class="language-text"><code>Defaults        env_keep += &quot;PYTHONPATH&quot;
Defaults        env_keep += &quot;PATH&quot;
Defaults        env_keep += &quot;ROS_ROOT&quot;
Defaults        env_keep += &quot;ROS_MASTER_URI&quot;
Defaults        env_keep += &quot;ROS_PACKAGE_PATH&quot;
Defaults        env_keep += &quot;ROS_LOCATIONS&quot;
Defaults        env_keep += &quot;ROS_HOME&quot;
Defaults        env_keep += &quot;ROS_LOG_DIR&quot;
</code></pre></div><h2 id="sample-program-for-the-led-strip" tabindex="-1"><a class="header-anchor" href="#sample-program-for-the-led-strip" aria-hidden="true">#</a> Sample program for the LED strip</h2><p>The following code lights up the first 10 LEDs on the LED strip. You may use it to check whether your LED strip works correctly:</p><div class="language-python ext-py"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">from</span> rpi_ws281x <span class="token keyword">import</span> Adafruit_NeoPixel
<span class="token keyword">from</span> rpi_ws281x <span class="token keyword">import</span> Color


LED_COUNT      <span class="token operator">=</span> <span class="token number">10</span>      <span class="token comment"># Number of LED pixels</span>
LED_PIN        <span class="token operator">=</span> <span class="token number">21</span>      <span class="token comment"># GPIO pin for the strip</span>
LED_FREQ_HZ    <span class="token operator">=</span> <span class="token number">800000</span>  <span class="token comment"># LED signal frequency in hertz (usually 800khz)</span>
LED_DMA        <span class="token operator">=</span> <span class="token number">10</span>      <span class="token comment"># DMA channel to use for generating signal (try 10)</span>
LED_BRIGHTNESS <span class="token operator">=</span> <span class="token number">255</span>     <span class="token comment"># Set to 0 for darkest and 255 for brightest</span>
LED_INVERT     <span class="token operator">=</span> <span class="token boolean">False</span>   <span class="token comment"># True to invert the signal (when using NPN transistor level shift)</span>
LED_CHANNEL    <span class="token operator">=</span> <span class="token number">0</span>       <span class="token comment"># Set to &#39;1&#39; for GPIOs 13, 19, 41, 45 or 53</span>

strip <span class="token operator">=</span> Adafruit_NeoPixel<span class="token punctuation">(</span>LED_COUNT<span class="token punctuation">,</span> LED_PIN<span class="token punctuation">,</span> LED_FREQ_HZ<span class="token punctuation">,</span> LED_DMA<span class="token punctuation">,</span> LED_INVERT<span class="token punctuation">)</span>

strip<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">colorWipe</span><span class="token punctuation">(</span>strip<span class="token punctuation">,</span> color<span class="token punctuation">,</span> wait_ms<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Wipe color across strip a pixel at a time.&quot;&quot;&quot;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>strip<span class="token punctuation">.</span>numPixels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        strip<span class="token punctuation">.</span>setPixelColor<span class="token punctuation">(</span>i<span class="token punctuation">,</span> color<span class="token punctuation">)</span>
        strip<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_ms<span class="token operator">/</span><span class="token number">1000.0</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Color wipe animations.&#39;</span><span class="token punctuation">)</span>
colorWipe<span class="token punctuation">(</span>strip<span class="token punctuation">,</span> Color<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait_ms<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># Red wipe</span>
colorWipe<span class="token punctuation">(</span>strip<span class="token punctuation">,</span> Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait_ms<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># Blue wipe</span>
colorWipe<span class="token punctuation">(</span>strip<span class="token punctuation">,</span> Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait_ms<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># Green wipe</span>
colorWipe<span class="token punctuation">(</span>strip<span class="token punctuation">,</span> Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait_ms<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>    <span class="token comment"># Turn LEDs off</span>
</code></pre></div>`,6),R={class:"custom-container tip"},N=n("p",{class:"custom-container-title"},"TIP",-1),q=s("You may also want to use additional test scripts from the "),S={href:"https://github.com/rpi-ws281x/rpi-ws281x-python/blob/master/examples",target:"_blank",rel:"noopener noreferrer"},O=s("LED library repository"),T=s("."),A=a(`<p>Save the script and run it as root:</p><div class="language-text ext-text"><pre class="language-text"><code>sudo python led_test.py
</code></pre></div><h2 id="basic-led-library-functions" tabindex="-1"><a class="header-anchor" href="#basic-led-library-functions" aria-hidden="true">#</a> Basic LED library functions</h2><p>You&#39;ll need to import <code>Adafruit_NeoPixel</code> class and <code>Color</code> function into your program to interact with the LED strip. Additionally, you&#39;ll want the <code>time</code> module to add delays to your animations:</p><div class="language-python ext-py"><pre class="language-python"><code><span class="token keyword">from</span> rpi_ws281x <span class="token keyword">import</span> Adafruit_NeoPixel
<span class="token keyword">from</span> rpi_ws281x <span class="token keyword">import</span> Color
<span class="token keyword">import</span> time
</code></pre></div><p>Instantiate the <code>Adafruit_NeoPixel</code> object and call its <code>begin()</code> method to start working with the strip:</p><div class="language-text ext-text"><pre class="language-text"><code># Strip object instantiation (parameter description is provided in a code snippet above)
strip = Adafruit_NeoPixel(LED_COUNT, LED_PIN, LED_FREQ_HZ, LED_DMA, LED_INVERT)
strip.begin()
</code></pre></div><p>Main strip control methods:</p><ul><li><code>numPixels()</code> returns the number of pixels in the strip. Convenient for whole strip operations.</li><li><code>setPixelColor(pos, color)</code> sets the pixel color at <code>pos</code> to <code>color</code>. Color should be a 24-bit value, where the first 8 bits are for the red channel, the next 8 bits are for the green channel, and the last 8 bits are for the blue channel. You may use the <code>Color(red, green, blue)</code> convenience function to convert colors to this format. Each color value should be an integer in the [0..255] range, where 0 means zero brightness and 255 means full brightness.</li><li><code>SetPixelColorRGB(pos, red, green, blue)</code> sets the pixel at <code>pos</code> to the color value with components <code>red</code>, <code>green</code> and <code>blue</code>. Each component value should be an integer in the [0..255] range, where 0 means zero brightness and 255 means full brightness.</li><li><code>show()</code> updates the strip state. Any changes to the strip state are only pushed to the actual strip after calling this method.</li></ul><h2 id="does-it-have-to-be-this-way" tabindex="-1"><a class="header-anchor" href="#does-it-have-to-be-this-way" aria-hidden="true">#</a> Does it have to be this way?</h2><p>The LED strip type used in the Clover kits use the following protocol: a data source (a Raspberry Pi, for example) sends a bit stream, 24 bits per LED. Each LED reads the first 24 bits from the stream and sets its color accordingly while passing the rest of the stream to the next LED. Zeroes and ones are encoded by different pulse lengths.</p>`,11),M=s("This LED strip is supported by the "),G={href:"https://github.com/jgarff/rpi_ws281x",target:"_blank",rel:"noopener noreferrer"},W=s("rpi_ws281x"),H=s(" library. The library uses the DMA (direct memory access) module of the Raspberry CPU and can utilize one of the three periphery channels: PWM, PCM or SPI. This allows the library to drive the strip consistently in a multitasking environment."),z=a("<p>Each channel has its caveats. Using the PWM prevents you from using the builtin Raspberry audio subsystem; using the PCM channel will prevent you from adding I2S (digital audio) devices, although the analog audio will work. SPI requires you to change your GPU and buffer size and prevents you from using any SPI devices.</p><p>Some DMA channels are reserved for system use. DMA channel 5 is used for SD card reads and writes, and setting LED_DMA to 5 will corrupt your filesystem. DMA channel 10 is considered to be safe.</p><p>You have the following options for the LED strip:</p><ol><li><p>If you don&#39;t need onboard audio, you may use the PWM channel and connect the LED strip to one of the following GPIO pins: 12, 18, 40 or 52 for PWM0 and 13, 19, 41, 45 or 53 for PWM1.</p></li><li><p>If you don&#39;t care about SPI devices, you may use the SPI channel for the LED with GPIO pins 10 or 38. You&#39;ll have to perform the following adjustments:</p><ul><li>increase the SPI device buffer by adding <code>spidev.bufsiz=32768</code> option to <code>/boot/cmdline.txt</code>;</li><li>set the GPU frequency to 250 MHz by adding <code>core_freq=250</code> to <code>/boot/cmdline.txt</code>;</li><li>reboot your Raspberry Pi: <code>sudo reboot</code>.</li></ul></li><li><p>If you care about audio and SPI devices, you may want to use the PCM channel (GPIO 21 or 31). You don&#39;t have to reconfigure your Raspberry.</p></li></ol><p>The default option is 3, because it allows the builtin audio system to work and does not require any modifications to the boot sequence.</p>",5);function B(U,Y){const t=o("ExternalLinkIcon"),p=o("RouterLink");return r(),c(u,null,[k,m,n("div",_,[f,n("p",null,[b,n("a",y,[g,e(t)])])]),w,v,D,n("div",E,[x,n("p",null,[P,e(p,{to:"/en/gpio.html"},{default:l(()=>[L]),_:1}),I])]),C,n("div",R,[N,n("p",null,[q,n("a",S,[O,e(t)]),T])]),A,n("p",null,[M,n("a",G,[W,e(t)]),H]),z],64)}var j=i(h,[["render",B],["__file","leds_old.html.vue"]]);export{j as default};
